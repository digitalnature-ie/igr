---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

plot_maps <- requireNamespace("maps", quietly = TRUE) & requireNamespace("tmap", quietly = TRUE)
```

# igr: Irish Grid References in R <img src="man/figures/logo.png" align="right" height="139" alt="" />

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
<!-- [![CRAN status](https://www.r-pkg.org/badges/version/igr)](https://CRAN.R-project.org/package=igr) -->
[![R-CMD-check](https://github.com/digitalnature-ie/igr/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/digitalnature-ie/igr/actions/workflows/R-CMD-check.yaml)
[![test-coverage](https://github.com/digitalnature-ie/igr/actions/workflows/test-coverage.yaml/badge.svg)](https://github.com/digitalnature-ie/igr/actions/workflows/test-coverage.yaml)
[![Codecov test coverage](https://codecov.io/gh/digitalnature-ie/igr/branch/main/graph/badge.svg)](https://app.codecov.io/gh/digitalnature-ie/igr?branch=main)
<!-- badges: end -->

Convert between Irish grid references and Irish Grid coordinates or an sf object.

An Irish grid reference consists of a letter, optionally followed by an easting and northing. Each Irish grid reference refers to a square on the Irish Grid ([EPSG:29903](https://epsg.io/29903)). A letter alone (e.g. "N") refers to a particular 100 km square. An Irish grid reference with a 1-digit easting and northing (e.g. "N85") refers to a 10 km square. A 5-digit easting and northing (e.g. "N 12345 67890") refers to a 1 m square.

This package supports Irish grid references of 1 m, 10 m, 100 m, 1 km, 10 km and 100 km precision. Irish grid references can be of mixed precision, and whitespace between letter, easting and northing is optional.

When converting Irish grid references to point locations (using `igr_to_ig()`, or `st_igr_as_sf()` with the default `polygons=FALSE`), the south west corners of the relevant Irish Grid squares are returned. When converting to polygons (using `st_igr_as_sf()` with `polygons=TRUE`), the polygons returned span the entire square of each grid reference.

The functions `st_igr_as_sf()` and `st_irishgridrefs()` convert to and from [sf](https://r-spatial.github.io/sf/) (simple feature) objects in any coordinate reference system.

## Installation

To install the development version of igr:

``` r
# Install devtools package if needed
install.packages("devtools")

# Load devtools package if needed
library(devtools)     

# Install development version of igr package from github
install_github("digitalnature-ie/igr")

```
## Usage

To check validity of Irish grid references:

* `igr_is_valid()` indicates which elements in a character vector are valid Irish grid references

To convert from Irish grid references:

* `igr_to_ig()` converts from a vector of Irish grid references to a matrix of Irish Grid coordinates
* `st_igr_as_sf()` converts from a data.frame containing Irish grid references to an sf object containing points or polygons

To convert to Irish grid references:

* `ig_to_igr()` converts from a list or matrix of Irish Grid coordinates to Irish grid references
* `st_irishgridrefs()` converts from an sf object to Irish grid references

### Check Irish grid references

```{r example-igr-valid}
library(igr)

# Sample grid references
igrs <- c("A", "A16", "A123678", "BAD", "I12", "", "B125", "Z")

igr_is_valid(igrs)
```

### Convert from Irish grid references

```{r example-igr-as-sf}
# Sample grid references
igrs <- c("A", "D12", "J53", "M5090", "N876274", "S1234550000", "W")

# Converting to Irish Grid coordinates
igr_to_ig(igrs)
# Sample grid references in a data.frame
igrs_df <- data.frame(igr = igrs)

# Converting to an sf object of POINT features
st_igr_as_sf(igrs_df, "igr")
```

```{r example-igr-points, message=FALSE, echo=FALSE, eval=plot_maps}
library(maps)
library(tmap)

points_sf <- st_igr_as_sf(igrs_df, "igr")

ie_uk_sf <- maps::map("world",
  regions = c("Ireland", "UK"),
  plot = FALSE,
  fill = TRUE
) |>
  sf::st_as_sf(ie_uk) |>
  sf::st_transform(29903)

tm_shape(points_sf, ext = 1.4) +
  tm_dots(size = 1, col = "cornflowerblue") +
  tm_text("igr", ymod = 1) +
  tm_shape(ie_uk_sf) +
  tm_borders()
```


```{r}
# Converting to an sf object of POLYGON features
st_igr_as_sf(igrs_df, "igr", polygon = TRUE)
```

```{r example-igr-polygons, message=FALSE, echo=FALSE, eval=plot_maps}
polygons_sf <- st_igr_as_sf(igrs_df, "igr", polygons = TRUE)

polygons_sf$area <- sf::st_area(polygons_sf)

small_polygons_sf <- polygons_sf[polygons_sf$area <= units::set_units(1000000, m^2),]


tm_shape(ie_uk_sf, bbox = points_sf, ext = 1.4) +
  tm_borders() +
  tm_shape(polygons_sf) +
  tm_polygons(size = 1, col = "cornflowerblue", alpha = 0.5) +
  tm_text("igr", ymod = -1) +
  tm_shape(small_polygons_sf) +
  tm_bubbles(
      alpha = 0, border.col = "orangered", border.lwd = 2,
      size = 0.8
    ) 
  
```

### Convert to Irish grid references

```{r example ig-to-igr}
# Sample Irish Grid coordinates
p <- matrix(c(0, 490000, 400000, 0, 453000, 4000), ncol = 2, byrow = TRUE)
colnames(p) <- c("x", "y")

p
# Convert to Irish grid references
ig_to_igr(p)
# Sample Irish Grid coordinates in an sf object
p_sf <- sf::st_as_sf(data.frame(p), crs = 29903, coords = c("x", "y"))

# Convert sf object to Irish grid references
st_irishgridrefs(p_sf, sep = " ")
```

```{r, eval = FALSE}
# Append Irish grid references to original sf object (using base R)
p_sf$igr <- st_irishgridrefs(p_sf)

# Append Irish grid references to original sf object (using tidy R)
p_sf <- p_sf |>
  dplyr::mutate(igr = st_irishgridrefs(p_sf))
```

# Design and Implementation

This package is designed to work seamlessly in tidy R. Function names, parameter names, and function behaviour attempt to follow conventions in related R packages such as [sf](https://r-spatial.github.io/sf/).

The very helpful 2nd edition of ["R Packages"](https://r-pkgs.org/) by Hadley Wickham and Jennifer Bryan was consulted extensively during development. The code is implemented using base R where possible to minimise package dependencies, and adopts the [tidyverse coding style](https://style.tidyverse.org/).

# Feedback 

Please log any unexpected behaviour or suggestions via GitHub [Issues](https://github.com/digitalnature-ie/igr/issues).
